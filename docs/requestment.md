# 历史人物猜谜游戏

## 项目概述

一个基于 Web 的、兼容 PC 和移动端的历史人物猜谜游戏。
游戏的核心机制是，系统通过生成式 AI 提供关于一位匿名历史人物的 10 条从难到易的线索，玩家根据线索猜测人物身份。

## 核心游戏流程

1. 游戏开始： 用户访问网站首页，点击“开始游戏”进入设置界面。
2. 游戏设置： 用户根据偏好选择以下选项：
   - 时间范围：
     - 选项：`古典时代`、`后古典时代`、`近代早期`、`近现代`。
     - 默认值：`近现代`
   - 地域范围：
     - 选项：`亚洲`、`欧洲`、`美洲`、`其他`。
     - 默认值：`欧洲`
   - 难度等级：
     - 选项：`简单`、`普通`、`困难`。
     - 默认值：`普通`
3. 谜题生成：用户确认设置后，后端 AI 服务根据所选参数生成一个谜题（一位历史人物及其对应的 10 条线索）。在等待后端服务响应期间，前端应该立刻展示一个生成中的界面，避免AI服务响应时间过长。如果超时未响应或响应错误，前端展示生成失败的错误页面。
4. 开始猜谜：
    - 系统呈现第 1 条线索。
    - 用户在输入框中提交答案。
5. 答案判断：
    - 回答正确：游戏结束，显示成功界面，公布谜底并提供人物简介。
    - 回答错误：系统提示错误，并呈现下一条线索。此过程重复。
6. 游戏结束：
    - 猜对人物： 流程如上。
    - 10 次机会用尽：猜完第 10 条线索后仍回答错误，游戏结束，显示失败界面，公布谜底。
    - 主动放弃：用户在任何时候都可以选择“放弃”，游戏结束，直接公布谜底。
7. 再来一局：游戏结束后，用户可以选择以相同的设置或全新的设置开始新一局游戏。

## 详细功能设计

### 游戏设置界面

- 时间范围选择器：
  - 选择器：单选按钮
  - 选项：
    - `古典时代`：约公元前 8 世纪 - 公元 6 世纪
    - `后古典时代`：约公元 6 世纪 - 15 世纪末
    - `近代早期`：约 15 世纪末 - 18 世纪末
    - `近现代`：约 18 世纪末至今
  - 默认值：`近现代`
- 地域范围
  - 选择器：单选按钮
  - 选项：`亚洲`、`欧洲`、`美洲`、`其他`。
  - 默认值：`欧洲`
- 难度等级
  - 选择器：单选按钮
  - 选项：`简单`、`普通`、`困难`。
  - 默认值：`普通`
  - 难度机制：
    - 人物库：`简单`难度倾向于全球闻名的人物（如：凯撒、牛顿）。`困难`难度则包含更具专业性或在特定文化圈内知名的人物（如：伊本·西那、拉格朗日）。
    - 线索晦涩度：`困难`难度的首条线索会比`简单`难度的首条线索更具迷惑性、更细节或更早期。所有难度的线索都将严格遵循从难到易的梯度。

### 主游戏界面

- 响应式布局：确保在桌面和移动设备上都有良好的视觉和操作体验（移动优先设计）。
- 提示区：
  - 当前提示编号（例如：“第 3 / 10 条提示”）。
  - 当前提示的文本内容。
  - 一个可点击的按钮/链接，名为“查看已给出的提示”，点击后可展开或以弹窗形式显示所有已出现的提示列表。
- 互动区：
  - 一个清晰的文本输入框，提示用户“请输入人物姓名”。
  - 一个主要的“提交”按钮。
  - 一个次要的“放弃”按钮。
- 即时反馈：
  - 提交后，按钮应有加载状态，防止重复提交。
  - 回答错误时，输入框上方或下方应有明确的文字提示。

### 内容生成

- 核心技术：采用**检索增强生成 (RAG - Retrieval-Augmented Generation)** 模式，确保信息准确性并减少 AI 幻觉。
- 生成流程：
    1. 后端根据用户选择的`时间`、`地域`、`难度`，从一个预先建立的人物索引库中筛选出合适的目标人物。
    2. 系统定位到该人物权威的资料源（首选维基百科/Wikipedia）。
    3. 系统将该人物的维基百科页面内容作为上下文（Context）提供给生成式 AI。
    4. 系统使用一个高度结构化的 Prompt 指令，要求 AI **仅根据提供的上下文**生成 10 条线索，并严格遵守以下规则：
        - 从难到易排列。
        - 禁止出现人物姓名、任何别名、特定作品名、具体国号/朝代名、公元年份等。
        - 确保事实准确。
- 数据输出格式：AI 应返回结构化的 JSON 数据，便于后端处理和存储。

    ```json
    {
      "figureName": "艾萨克·牛顿",
      "aliases": ["牛顿", "Isaac Newton", "newton"], // 用于答案校验的别名库
      "clues": [
          "关于我早年对炼金术的痴迷鲜为人知。",
          "我曾用自制的仪器进行了大量光学实验。",
          "我曾长期掌管一个国家的铸币工作，并严厉打击伪币制造者。",
          "我与一位德国数学家就微积分的发明权发生过激烈争论。",
          "我提出了三大运动定律，改变了人类对物理世界的理解。",
          "我担任过皇家学会的主席长达二十四年之久。",
          "我的代表作《自然哲学的数学原理》被誉为科学史上最重要的著作之一。",
          "我在剑桥大学三一学院学习并后来成为教授。",
          "我出生于一个农民家庭，但最终成为英国科学界的泰斗。",
          "据说，一颗苹果的坠落给了我最伟大的灵感。"
      ],
      "timePeriod": "近代早期",
      "region": "欧洲",
      "difficulty": "简单",
      "sourceURL": "https://en.wikipedia.org/wiki/Isaac_Newton" // 信息来源，便于核查
    }
    ```

- 题库缓存：成功生成的谜题（人物、线索、元数据）应存入数据库。当再次有相同条件的请求时，可优先从数据库中抽取，以降低 API 成本并保证题目质量。

### 答案校验逻辑

- 后端接收用户提交的答案。
- 将用户答案进行标准化处理（例如：去除空格、转换为统一的大小写）。
- 与当前谜题在数据库中存储的`aliases`数组进行匹配。只要命中数组中的任何一个元素，即判定为正确。

### 游戏结束界面

- 通用元素：
  - 清晰地展示谜底人物的姓名和一张代表性图片/肖像。
  - 一段关于该人物的生平简介。
  - 完整回顾本局游戏的所有 10 条线索。
  - “再玩一局”和“返回主页”的按钮。
- 定制化信息：
  - 成功界面：醒目的“恭喜你，答对了！”标题，显示用户在第几条线索时猜出。
  - 失败/放弃界面：带有鼓励性质的标题，如“差一点就猜到了！”或“真相揭晓”。

## 技术架构

- 前端：Nextjs + Typescript + TailwindCss
- 后端：Nextjs API Routes
- AI 服务：调用支持长上下文的大语言模型 API（如 OpenAI 的 GPT Google 的 Gemini 等）。
- 数据库： Prisma + PostgreSQL，用于存储用户数据（如果需要）和缓存生成的题库。
